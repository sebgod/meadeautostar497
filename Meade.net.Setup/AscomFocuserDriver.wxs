<?xml version="1.0" encoding="UTF-8"?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <?include $(sys.CURRENTDIR)\Config.wxi?>
  <!--
    ASCOM Focuser Driver with COM registry entries suitable for a LocalServer Served Class
  -->
  <Fragment>
    <DirectoryRef Id="INSTALLFOLDER" />
<!--    <CustomActionRef Id="caPrepareAscomDeviceProfiles"/>
    <CustomActionRef Id="caUnregisterDrivers"/>
    <CustomActionRef Id="caRegisterDrivers"/>-->
    <ComponentGroup Id="cgAscomFocuserDriver">
      <ComponentGroupRef Id="cgAscomLocalServer" />
      <Component Id="cmpAscomFocuserDriver"
                 Directory="INSTALLFOLDER"
                 Guid="*"
                 Win64="no">
        <File Id="filFocuserDriverAssembly"
              Source="$(var.Meade.net.focuser.TargetPath)"
              KeyPath="yes"
              Vital="yes"
              Assembly=".net"
              AssemblyApplication="filFocuserDriverAssembly" />
        <!-- Registry entries suitable for a LocalServer served class -->
        <!-- HKCR\CLSID\{driver-guid} -->
        <RegistryKey Root="HKCR" Key="CLSID">
          <RegistryKey Key="$(var.FocuserDriverClassId)">
            <RegistryValue Value="$(var.FocuserDriverProgId)" Type="string"/>
            <RegistryValue Name="AppId" Value="$(var.LocalServerAppId)" Type="string"/>
            <RegistryKey Key="Implemented Categories">
              <RegistryKey Key="{62C8FE65-4EBB-45e7-B440-6E39B2CDBF29}"
                           ForceCreateOnInstall="yes"
                           ForceDeleteOnUninstall="yes"/>
            </RegistryKey>
            <RegistryKey Key="ProgId">
              <RegistryValue Value="$(var.FocuserDriverProgId)" Type="string"/>
            </RegistryKey>
            <RegistryKey Key="Programmable"
                         ForceCreateOnInstall="yes"
                         ForceDeleteOnUninstall="yes" />
            <RegistryKey Key="LocalServer32">
              <RegistryValue Value="[#filLocalServerAssembly]" Type="string"/>
            </RegistryKey>
          </RegistryKey>
        </RegistryKey>

        <!-- HKCR\{driver-prog-id} -->
        <RegistryKey Root="HKCR" Key="$(var.FocuserDriverProgId)">
          <RegistryValue Value="$(var.FocuserDriverDescription)" Type="string"/>
          <RegistryKey Key="CLSID">
            <RegistryValue Value="$(var.FocuserDriverClassId)" Type="string" />
          </RegistryKey>
        </RegistryKey>
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>